[?2004h[?1049h[22;0;0t[1;53r(B[m[4l[?7h[39;49m[?1h=[?1h=[?25l[39;49m(B[m[H[2J[51;89H(B[0;7m[ Reading... ](B[m[51;87H(B[0;7m[ Read 309 lines ](B[m[H(B[0;7m  GNU nano 4.8                                                                       smart_failure_scanner.py                                                                                 [1;189H(B[m[52d(B[0;7m^G(B[m Get Help[18G(B[0;7m^O(B[m Write Out     (B[0;7m^W(B[m Where Is[52G(B[0;7m^K(B[m Cut Text[69G(B[0;7m^J(B[m Justify[86G(B[0;7m^C(B[m Cur Pos[103G(B[0;7mM-U(B[m Undo[52;120H(B[0;7mM-A(B[m Mark Text    (B[0;7mM-](B[m To Bracket   (B[0;7mM-Q(B[m Previous     (B[0;7m^B(B[m Back[53d(B[0;7m^X(B[m Exit[53;18H(B[0;7m^R(B[m Read File     (B[0;7m^\(B[m Replace[52G(B[0;7m^U(B[m Paste Text    (B[0;7m^T(B[m To Spell[86G(B[0;7m^_(B[m Go To Line    (B[0;7mM-E(B[m Redo[53;120H(B[0;7mM-6(B[m Copy Text    (B[0;7m^Q(B[m Where Was     (B[0;7mM-W(B[m Next[53;171H(B[0;7m^F(B[m Forward[51d[2d(B[0;1m[31m#!/usr/bin/env python3[4d[36mimport[39m(B[m os[5d(B[0;1m[36mimport[39m(B[m re[6d(B[0;1m[36mimport[39m(B[m sys[7d(B[0;1m[36mimport[39m(B[m time[8d(B[0;1m[36mimport[39m(B[m math[9d(B[0;1m[36mimport[39m(B[m threading[11d(B[0;1m[36mfrom[39m(B[m subprocess (B[0;1m[36mimport[39m(B[m Popen, PIPE, STDOUT, call, check_output[12d(B[0;1m[36mfrom[39m(B[m time (B[0;1m[36mimport[39m(B[m gmtime, strftime, sleep[14d(B[0;1m[31m# Arrays for SysExec caching[15d[39m(B[mCacheDataArray = {}[16dCacheTimeArray = {}[18d(B[0;1m[31m# Set "True" to print debugging info[19d[39m(B[mPrint_Debug = (B[0;1m[35mTrue[21d[36mdef[34m Debug[39m(B[m(text):[23;9H(B[0;1m[32m"""[24;8H[1K A wrapper to print debugging info on a single line.[25;8H[1K """[27;9H[36mif[39m(B[m Print_Debug:[28;17Hprint((B[0;1m[32m"DEBUG: "[39m(B[m + text)[29;9H(B[0;1m[36mreturn[32ddef[34m SysExec[39m(B[m(cmd):[34;9H(B[0;1m[32m"""[35;8H[1K Run the given command and return the output[36;8H[1K """[38d[31m#        Debug("SysExec():: cmd = '" + cmd + "'")[40;8H # Cache the output of the command for the given number of seconds[41;9H[39m(B[mCache_Expires = 60[43;8H(B[0;1m[31m # Computed once, used twice[44;9H[39m(B[mCache_Keys = list(CacheDataArray.keys())[45;9H(B[0;1m[36mif[39m(B[m cmd (B[0;1m[36min[39m(B[m Cache_Keys:[46;17HCache_Age  = time.time() - CacheTimeArray[cmd][47;9H(B[0;1m[36melse[39m(B[m:[48;17HCache_Age  = 0[50;9HReturn_Val = (B[0;1m[32m"ERROR"[2d[39m(B[m[?12l[?25h[?25l[52;18H[21X[52;39H(B[0;7mM-C(B[m Case Sens           [69G        (B[0;7mM-B(B[m Backwards      [103G            (B[0;7m^P(B[m Older[30X[52;153H(B[0;7m^T(B[m Go To Line[K[53;2H(B[0;7mC(B[m Cancel[53;18H[21X[53;39H(B[0;7mM-R(B[m Regexp[28X[53;77H(B[0;7m^R(B[m Replace[28X[53;115H(B[0;7m^N(B[m Newer[30X[53;153H(B[0;7mM-J(B[m FullJstify[K[51d(B[0;7mSearch:                                                                                                                                                                                       [51;1H(B[m[51;9H[?12l[?25h[?25l(B[0;7mi(B[m[51;10H[?12l[?25h[?25l(B[0;7mt(B[m[51;11H[?12l[?25h[?25l(B[0;7me(B[m[51;12H[?12l[?25h[?25l(B[0;7mr(B[m[51;13H[?12l[?25h[?25l(B[0;7m((B[m[51;14H[?12l[?25h[?25l(B[0;7m)(B[m[51;15H[?12l[?25h[?25l[K[52;18H(B[0;7m^O(B[m Write Out     (B[0;7m^W(B[m Where Is      (B[0;7m^K(B[m Cut Text[69G(B[0;7m^J(B[m Justify       (B[0;7m^C(B[m Cur Pos[103G(B[0;7mM-U(B[m Undo         (B[0;7mM-A(B[m Mark Text    (B[0;7mM-](B[m To Bracket   (B[0;7mM-Q(B[m Previous     (B[0;7m^B(B[m Back[53;2H(B[0;7mX(B[m Exit  [53;18H(B[0;7m^R(B[m Read File     (B[0;7m^\(B[m Replace       (B[0;7m^U(B[m Paste Text    (B[0;7m^T(B[m To Spell      (B[0;7m^_(B[m Go To Line    (B[0;7mM-E(B[m Redo         (B[0;7mM-6(B[m Copy Text    (B[0;7m^Q(B[m Where Was     (B[0;7mM-W(B[m Next         (B[0;7m^F(B[m Forward[51d[2;32H[1K (B[0;1m[36mcontinue[4;16H[39m(B[m[1K (B[0;1m[31m        # One Intel SSD has a buggy 233 Media_Wearout_Indicator, so ignore that special case[5;24H[39m(B[m[1K (B[0;1m[36mif[39m(B[m smart_attributes[(B[0;1m[32m"id"[39m(B[m] == (B[0;1m[32m"233"[39m(B[m (B[0;1m[36mand[39m(B[m findModel(Dev) == (B[0;1m[32m"SSDSA2M040G2GC"[39m(B[m:[6;32H[1K (B[0;1m[36mcontinue[7d[39m(B[m[K[8;16H[1K (B[0;1m[31m        # Now test for bad drives[9d[39m(B[m[K[10;17H(B[0;1m[31m        # This is a drive with a large number of failed sectors that isn't yet failing SMART[11;24H[39m(B[m[1K Thresh_197 = 500[K[12;24H[1K (B[0;1m[36mif[39m(B[m smart_attributes[(B[0;1m[32m"id"[39m(B[m] == (B[0;1m[32m"197"[39m(B[m:[13;33H(B[0;1m[36mif[39m(B[m int(smart_attributes[(B[0;1m[32m"value"[39m(B[m]) > Thresh_197:[14;40H[1K print((B[0;1m[32m"Dev "[39m(B[m + Dev + (B[0;1m[32m" has a 197 Current_Pending_Sector value over "[39m(B[m + Thresh_197)[15d[K[16;24H[1K Delta = int(smart_attributes[(B[0;1m[32m"value"[39m(B[m]) - int(smart_attributes[(B[0;1m[32m"thresh"[39m(B[m])[18;24H[1K (B[0;1m[36mif[39m(B[m Delta <= 0:[19;32H[1K print((B[0;1m[32m"Dev "[39m(B[m + Dev + (B[0;1m[32m" is failing on SMART attribute "[39m(B[m + smart_attributes[(B[0;1m[32m"id"[39m(B[m] + (B[0;1m[32m" "[39m(B[m + smart_attributes[(B[0;1m[32m"attribute_name"[39m(B[m])[21;24H[1K (B[0;1m[36mif[39m(B[m Delta < 10 (B[0;1m[36mand[39m(B[m Delta > 0 (B[0;1m[36mand[39m(B[m int(smart_attributes[(B[0;1m[32m"thresh"[39m(B[m]) < 50:[22;33Hprint((B[0;1m[32m"Dev "[39m(B[m + Dev + (B[0;1m[32m" is marginal on SMART attribute "[39m(B[m + smart_attributes[(B[0;1m[32m"id"[39m(B[m] + (B[0;1m[32m" "[39m(B[m + smart_attributes[(B[0;1m[32m"attribute_name"[39m(B[m])[23d[K[24;8H[1K (B[0;1m[31m        # Pass 2:  Scan smartctl output for <stuff>[25d[39m(B[m[K[26;17H(B[0;1m[36mfor[39m(B[m line (B[0;1m[36min[39m(B[m SysExec((B[0;1m[32m"smartctl -x "[39m(B[m + Dev).splitlines().iter():[27d[K[28;24H[1K (B[0;1m[36mif[39m(B[m re.search((B[0;1m[32m"Self-test execution status:"[39m(B[m, line):[29d[K[30;33Hmsg = line.split((B[0;1m[32m")"[39m(B[m)[1][31;33Hmsg_finished = (B[0;1m[35mFalse[32;32H[39m(B[m[1K (B[0;1m[36mwhile[39m(B[m (B[0;1m[36mnot[39m(B[m msg_finished:[33;41Hline = next(line)[34;40H[1K (B[0;1m[36mif[39m(B[m re.search((B[0;1m[32m"^[a-zA-Z]"[39m(B[m, line):[35;48H[1K msg_finished = (B[0;1m[35mTrue[36;40H[39m(B[m[1K (B[0;1m[36melse[39m(B[m:[37;49Hmsg = msg + line[38d[K[39;33HDebug((B[0;1m[32m"Self-test execution status: "[39m(B[m + msg)[40d[K[41;32H[1K (B[0;1m[36mif[39m(B[m re.search((B[0;1m[32m"The previous self-test completed having the read element of the test failed"[39m(B[m, msg):[42;41Hprint((B[0;1m[32m"Dev "[39m(B[m + Dev + (B[0;1m[32m" is failing a read-element test."[39m(B[m)[43d[K[44;32H[1K (B[0;1m[36mif[39m(B[m re.search((B[0;1m[32m"The previous self-test completed having a test element that failed"[39m(B[m, msg):[45;40H[1K print((B[0;1m[32m"Dev "[39m(B[m + Dev + (B[0;1m[32m" is failing a test-element test."[39m(B[m)[46d[K[47d[K[48d(B[0;1m[31m#       elif Drive_Transport[Dev] == "SAS":[49d#[15X[49;17HDefects=`smart_attributes ${dev} | grep 9000_SAS_Grown_Defect_List | awk '{ print $2 }'`[50d#[39m(B[m[K[26;72H[?12l[?25h[?25l[79G[?12l[?25h[?25l[?12l[?25h[?25l[1;181H(B[0;7mModified(B[m[26;77H:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l:[K[?12l[?25h[?25l):[?12l[?25h[?25l[52;18H[30X[52;48H(B[0;7mM-D(B[m DOS Format [69G          [86G         (B[0;7mM-A(B[m Append      [52;120H[22X[52;142H(B[0;7mM-B(B[m Backup File[K[53;2H(B[0;7mC(B[m Cancel[53;18H[30X[53;48H(B[0;7mM-M(B[m Mac Format[18X[53;86H         (B[0;7mM-P(B[m Prepend     [53;120H[22X[53;142H(B[0;7m^T(B[m To Files[K[51d(B[0;7mFile Name to Write: smart_failure_scanner.py                                                                                                                                                  [51;1H(B[m[51;45H[?12l[?25h[?25l[51;88H[1K (B[0;7m[ Writing... ](B[m[K[1;181H(B[0;7m        (B[m[51;86H(B[0;7m[ Wrote 309 lines ](B[m[52;18H(B[0;7m^O(B[m Write Out     (B[0;7m^W(B[m Where Is      (B[0;7m^K(B[m Cut Text[69G(B[0;7m^J(B[m Justify[86G(B[0;7m^C(B[m Cur Pos       (B[0;7mM-U(B[m Undo[52;120H(B[0;7mM-A(B[m Mark Text    (B[0;7mM-](B[m To Bracket   (B[0;7mM-Q(B[m Previous     (B[0;7m^B(B[m Back[53;2H(B[0;7mX(B[m Exit  [53;18H(B[0;7m^R(B[m Read File     (B[0;7m^\(B[m Replace       (B[0;7m^U(B[m Paste Text    (B[0;7m^T(B[m To Spell[86G(B[0;7m^_(B[m Go To Line    (B[0;7mM-E(B[m Redo[53;120H(B[0;7mM-6(B[m Copy Text    (B[0;7m^Q(B[m Where Was     (B[0;7mM-W(B[m Next[53;171H(B[0;7m^F(B[m Forward[51d[26;71H[?12l[?25h[?25l[51d[J[53d[?12l[?25h[53;1H[?1049l[23;0;0t[?1l>[?2004l